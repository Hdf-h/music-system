{"remainingRequest":"D:\\keshe\\音乐管理系统\\MusicSystem\\MusicSystemUserVue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\keshe\\音乐管理系统\\MusicSystem\\MusicSystemUserVue\\src\\pages\\Lyric.vue?vue&type=style&index=0&id=6986c4eb&lang=scss&scoped=true&","dependencies":[{"path":"D:\\keshe\\音乐管理系统\\MusicSystem\\MusicSystemUserVue\\src\\pages\\Lyric.vue","mtime":1679672496000},{"path":"D:\\keshe\\音乐管理系统\\MusicSystem\\MusicSystemUserVue\\node_modules\\@vue\\cli-service\\node_modules\\css-loader\\dist\\cjs.js","mtime":1696214897000},{"path":"D:\\keshe\\音乐管理系统\\MusicSystem\\MusicSystemUserVue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1696214897000},{"path":"D:\\keshe\\音乐管理系统\\MusicSystem\\MusicSystemUserVue\\node_modules\\@vue\\cli-service\\node_modules\\postcss-loader\\src\\index.js","mtime":1696214897000},{"path":"D:\\keshe\\音乐管理系统\\MusicSystem\\MusicSystemUserVue\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1697190997676},{"path":"D:\\keshe\\音乐管理系统\\MusicSystem\\MusicSystemUserVue\\node_modules\\@vue\\cli-service\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1696214897000},{"path":"D:\\keshe\\音乐管理系统\\MusicSystem\\MusicSystemUserVue\\node_modules\\@vue\\cli-service\\node_modules\\vue-loader\\lib\\index.js","mtime":1696214897000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQpAaW1wb3J0ICIuLi9hc3NldHMvY3NzL2x5cmljLnNjc3MiOw0K"},{"version":3,"sources":["Lyric.vue"],"names":[],"mappings":";AAuJA","file":"Lyric.vue","sourceRoot":"src/pages","sourcesContent":["<!--\r\n * @Description: \r\n * @Author: Rabbiter\r\n * @Date: 2023-03-16 01:26:34\r\n-->\r\n<template>\r\n  <div class=\"song-lyric\">\r\n    <h1 class=\"lyric-title\">歌词</h1>\r\n    <!-- 有歌词 -->\r\n    <ul class=\"has-lyric\" v-if=\"lyr.length\" key=\"index\">\r\n      <li v-for=\"(item, index) in lyr\" v-bind:key=\"index\">\r\n        {{ item[1] }}\r\n      </li>\r\n    </ul>\r\n    <!-- 没有歌词 -->\r\n    <div v-else class=\"no-lyric\" key=\"no-lyric\">\r\n      <span>暂无歌词</span>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { mixin } from \"../mixins\";\r\nimport { mapGetters } from \"vuex\";\r\nimport { songOfSongId } from \"../api/index\";\r\n\r\nexport default {\r\n  name: \"lyric\",\r\n  mixins: [mixin],\r\n  data() {\r\n    return {\r\n      lyr: [], //当前歌曲的歌词\r\n      songId: \"\", //当前歌曲id\r\n    };\r\n  },\r\n  computed: {\r\n    ...mapGetters([\r\n      \"curTime\", //当前歌曲播放到的位置\r\n      \"id\", //当前播放的歌曲id\r\n      \"lyric\", //歌词\r\n      \"listIndex\", //当前歌曲在歌单中的位置\r\n      \"listOfSongs\", //当前歌单列表\r\n    ]),\r\n  },\r\n  methods: {\r\n    replaceLName(str) {\r\n      let arr = str.split(\"-\");\r\n      return arr[0];\r\n    },\r\n    //获取名字后半部分--歌名\r\n    replaceFName(str) {\r\n      let arr = str.split(\"-\");\r\n      return arr[1];\r\n    },\r\n    //解析歌词\r\n    parseLyric(text) {\r\n      let lines = text.split(\"\\n\"); //将歌词按行分解成数组\r\n      let pattern = /\\[\\d{2}:\\d{2}.(\\d{3}|\\d{2})\\]/g; //时间格式的正则表达式\r\n      let result = []; //返回值\r\n      //对于歌词格式不对的直接返回\r\n      if (!/\\[.+\\]/.test(text)) {\r\n        return [[0, text]];\r\n      }\r\n      //去掉前面格式不正确的行\r\n      while (!pattern.test(lines[0])) {\r\n        lines = lines.slice(1);\r\n      }\r\n      //遍历每一行，形成一个每行带着俩元素的数组，第一个元素是以秒为计算单位的时间，第二个元素是歌词\r\n      for (let item of lines) {\r\n        let time = item.match(pattern); //存前面的时间段\r\n        let value = item.replace(pattern, \"\"); //存后面的歌词\r\n        for (let item1 of time) {\r\n          let t = item1.slice(1, -1).split(\":\"); //取出时间，换算成数组\r\n          if (value != \"\") {\r\n            result.push([parseInt(t[0], 10) * 60 + parseFloat(t[1]), value]);\r\n          }\r\n        }\r\n      }\r\n      //按照第一个元素--时间--排序\r\n      result.sort(function (a, b) {\r\n        return a[0] - b[0];\r\n      });\r\n      return result;\r\n    },\r\n    loadFromQuery() {\r\n      // 从url读取参数\r\n      var songId = this.$route.query.songId;\r\n      if (songId != null && songId != \"\") {\r\n        songOfSongId(songId)\r\n          .then((res) => {\r\n            if (res == \"\") {\r\n              return;\r\n            }\r\n\r\n            // this.toplay(res.id, res.url, res.pic, 0, res.name, res.lyric);\r\n            this.$store.commit(\"setId\", res.id);\r\n            this.$store.commit(\r\n              \"setUrl\",\r\n              this.$store.state.configure.HOST + res.url\r\n            );\r\n            this.$store.commit(\r\n              \"setPicUrl\",\r\n              this.$store.state.configure.HOST + res.pic\r\n            );\r\n            this.$store.commit(\"setListIndex\", 0);\r\n            this.$store.commit(\"setTitle\", this.replaceFName(res.name));\r\n            this.$store.commit(\"setArtist\", this.replaceLName(res.name));\r\n            this.$store.commit(\"setLyric\", this.parseLyric(res.lyric));\r\n            this.$store.commit(\"setIsActive\", false);\r\n            this.lyr = this.lyric;\r\n\r\n            // this.lyr = this.parseLyric(res.lyric);\r\n          })\r\n          .catch((err) => {\r\n            console.log(err);\r\n          });\r\n      } else {\r\n            this.lyr = this.lyric;\r\n      }\r\n    },\r\n  },\r\n  mounted() {\r\n    this.loadFromQuery();\r\n  },\r\n  watch: {\r\n    id: function () {\r\n      this.lyr = this.parseLyric(this.listOfSongs[this.listIndex].lyric);\r\n    },\r\n    curTime: function () {\r\n      if (this.lyr.length > 0) {\r\n        for (let i = 0; i < this.lyr.length; i++) {\r\n          if (this.curTime >= this.lyr[i][0]) {\r\n            for (let j = 0; j < this.lyr.length; j++) {\r\n              document.querySelectorAll(\".has-lyric li\")[j].style.color =\r\n                \"#000\";\r\n              document.querySelectorAll(\".has-lyric li\")[j].style.fontSize =\r\n                \"15px\";\r\n            }\r\n            if (i >= 0) {\r\n              document.querySelectorAll(\".has-lyric li\")[i].style.color =\r\n                \"#95d2f6\";\r\n              document.querySelectorAll(\".has-lyric li\")[i].style.fontSize =\r\n                \"25px\";\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n@import \"../assets/css/lyric.scss\";\r\n</style>"]}]}